<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>
  <title>Modern Odometer</title>
  <style>
    :root { --bg: #f0f2f5; --card-bg: #ffffff; --primary: #4a90e2; --text: #333333; --input-bg: #f9fafb; --input-border: #cccccc; }
    * { box-sizing: border-box; }
    body { background: var(--bg); font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0; padding: 2rem; color: var(--text); }
    .container { max-width: 1000px; margin: auto; }
    .add-btn { margin-bottom: 1rem; padding: 0.6rem 1rem; border: none; border-radius: 4px; background: var(--primary); color: #fff; cursor: pointer; }
    #counters { position: relative; height: 600px; border: 1px dashed #ccc; padding: 1rem; }
    .counter { position: absolute; background: var(--card-bg); padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); cursor: move; }
    .odometer { font-size: 3rem; font-weight: bold; text-align: center; margin-bottom: 1rem; font-variant-numeric: tabular-nums; transition: transform 0.3s ease; }
    .odometer.animate { transform: scale(1.2); }
    .controls { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px,1fr)); gap: 0.5rem; margin-bottom: 1rem; }
    .controls label { display: flex; flex-direction: column; font-size: 0.9rem; }
    .controls input[type='number'], .controls input[type='color'] { padding: 0.5rem; border: 1px solid var(--input-border); border-radius: 4px; background: var(--input-bg); font-size: 1rem; }
    .buttons { display: flex; gap: 0.5rem; justify-content: center; }
    .buttons button { padding: 0.6rem 1rem; border: none; border-radius: 4px; background: var(--primary); color: #fff; cursor: pointer; transition: background 0.2s; }
    .buttons button:disabled { opacity: 0.6; cursor: default; }
    .buttons button:not(:disabled):hover { background: #357ABD; }
  </style>
</head>
<body>
  <div class='container'>
    <button id='addCounterBtn' class='add-btn'>Add Counter</button>
    <div id='counters'></div>
  </div>

  <template id='counterTemplate'>
    <div class='counter'>
      <div class='odometer'>0</div>
      <div class='controls'>
        <label>Initial Count<input type='number' class='initCount' value='0'></label>
        <label>Min Gain<input type='number' class='minGain' value='1'></label>
        <label>Max Gain<input type='number' class='maxGain' value='5'></label>
        <label>Interval (ms)<input type='number' class='interval' value='1000'></label>
        <label>Color<input type='color' class='colorPicker' value='#4a90e2'></label>
      </div>
      <div class='buttons'>
        <button class='startBtn'>Start</button>
        <button class='stopBtn' disabled>Stop</button>
        <button class='setBtn'>Set Count</button>
      </div>
    </div>
  </template>

  <script>
    const countersContainer = document.getElementById('counters');
    const addBtn = document.getElementById('addCounterBtn');
    let counterId = 0;
    let dragEl = null, offsetX = 0, offsetY = 0;

    // Global drag handlers
    document.addEventListener('mousemove', e => {
      if (dragEl) {
        dragEl.style.left = (e.clientX - offsetX) + 'px';
        dragEl.style.top = (e.clientY - offsetY) + 'px';
      }
    });
    document.addEventListener('mouseup', () => {
      if (dragEl) {
        dragEl.style.cursor = 'move';
        dragEl = null;
      }
    });

    function createCounter() {
      const template = document.getElementById('counterTemplate');
      const clone = template.content.cloneNode(true);
      const node = clone.querySelector('.counter');
      const id = counterId++;
      node.dataset.id = id;
      // Initial position
      node.style.top = (20 + id * 120) + 'px';
      node.style.left = '20px';

      const odo = node.querySelector('.odometer');
      const initInput = node.querySelector('.initCount');
      const minGainInput = node.querySelector('.minGain');
      const maxGainInput = node.querySelector('.maxGain');
      const intervalInput = node.querySelector('.interval');
      const colorPicker = node.querySelector('.colorPicker');
      const startBtn = node.querySelector('.startBtn');
      const stopBtn = node.querySelector('.stopBtn');
      const setBtn = node.querySelector('.setBtn');

      let count = parseInt(initInput.value, 10) || 0;
      let timer = null;

      function updateDisplay() {
        odo.textContent = count;
        odo.style.color = colorPicker.value;
        odo.classList.add('animate');
        setTimeout(() => odo.classList.remove('animate'), 300);
      }
      function startOdo() {
        if (timer) return;
        timer = setInterval(() => {
          const min = parseInt(minGainInput.value, 10) || 0;
          const max = parseInt(maxGainInput.value, 10) || 0;
          const gain = Math.floor(Math.random() * (max - min + 1)) + min;
          count += gain;
          updateDisplay();
        }, parseInt(intervalInput.value, 10) || 1000);
        startBtn.disabled = true; stopBtn.disabled = false;
      }
      function stopOdo() {
        clearInterval(timer); timer = null;
        startBtn.disabled = false; stopBtn.disabled = true;
      }
      function setCount() {
        count = parseInt(initInput.value, 10) || 0;
        updateDisplay();
      }

      // Drag behavior
      node.addEventListener('mousedown', e => {
        dragEl = node;
        offsetX = e.clientX - node.offsetLeft;
        offsetY = e.clientY - node.offsetTop;
        node.style.cursor = 'grabbing';
      });

      startBtn.addEventListener('click', startOdo);
      stopBtn.addEventListener('click', stopOdo);
      setBtn.addEventListener('click', setCount);
      colorPicker.addEventListener('input', () => odo.style.color = colorPicker.value);

      updateDisplay();
      countersContainer.appendChild(clone);
    }

    addBtn.addEventListener('click', createCounter);
    createCounter();
  </script>
</body>
</html>
